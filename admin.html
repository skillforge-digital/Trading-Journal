<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Skillforge Admin Panel â€” manage students and publish leaderboard">
    <title>Admin Panel - Skillforge</title>
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore-compat.js" defer></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="pb-10 bg-slate-950">

    <header class="glass sticky top-0 z-50 border-b border-slate-800 shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-red-600 p-2 rounded-lg">
                    <i data-lucide="shield" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-extrabold tracking-tight text-white">
                        SKILLFORGE <span class="text-red-500">ADMIN</span>
                    </h1>
                </div>
            </div>
            <a href="index.html" class="text-slate-400 hover:text-white text-sm font-bold uppercase">Back to App</a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 mt-8 grid grid-cols-1 md:grid-cols-4 gap-6 relative">
        
        <!-- Sidebar: Student List -->
        <aside class="glass rounded-2xl overflow-hidden h-[80vh] flex flex-col sticky top-24">
            <div class="p-4 border-b border-slate-800 bg-slate-900/50">
                <h3 class="text-sm font-bold text-white uppercase">Students</h3>
            </div>
            <div id="studentList" class="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar touch-scroll">
                <!-- List items -->
                <p class="text-center text-slate-500 text-xs mt-4">Loading students...</p>
            </div>
        </aside>

        <!-- Main: Student Logs -->
        <section class="md:col-span-3 space-y-6">
            
            <!-- Selected Student Info -->
            <div id="studentHeader" class="glass p-6 rounded-2xl border-l-4 border-blue-500 hidden">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 id="studentEmail" class="text-2xl font-bold text-white">Select a Student</h2>
                        <p class="text-slate-500 text-xs uppercase tracking-widest mt-1">Student ID: <span id="studentId">---</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Total Profit</p>
                        <h3 id="adminTotalPnl" class="text-2xl font-black font-mono text-white">$0.00</h3>
                    </div>
                </div>
            </div>

            <!-- Trades Table -->
            <div class="glass rounded-2xl overflow-hidden min-h-[400px]">
                <div class="p-4 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
                    <h3 class="text-sm font-bold text-white uppercase">Trade Log</h3>
                    <div class="flex items-center gap-3">
                        <button onclick="refreshTrades()" class="text-slate-400 hover:text-white"><i data-lucide="refresh-cw" class="w-4 h-4"></i></button>
                        <button onclick="publishLeaderboard()" class="px-3 py-1.5 rounded-lg bg-blue-600 hover:bg-blue-500 text-white text-[10px] font-bold uppercase tracking-wider">Publish Leaderboard</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-900/80 text-[10px] uppercase text-slate-400 font-bold border-b border-slate-800">
                            <tr>
                                <th class="p-5">Time</th>
                                <th class="p-5">Asset</th>
                                <th class="p-5">Type</th>
                                <th class="p-5">Lots</th>
                                <th class="p-5">PnL</th>
                                <th class="p-5">Status</th>
                            </tr>
                        </thead>
                        <tbody id="adminTradeTable" class="divide-y divide-slate-800/50">
                            <tr>
                                <td colspan="6" class="p-8 text-center text-slate-500 text-sm font-bold uppercase tracking-wider opacity-50">Select a student to view trades.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Feedback Section -->
            <div id="feedbackSection" class="glass p-6 rounded-2xl hidden border border-slate-700">
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="message-square" class="text-blue-500 w-5 h-5"></i>
                    <h3 class="text-sm font-bold text-white uppercase tracking-wider">Mentor Feedback & Notes</h3>
                </div>
                
                <div id="commentsList" class="space-y-3 mb-6 max-h-60 overflow-y-auto pr-2 custom-scrollbar touch-scroll"></div>
                
                <form id="commentForm" class="flex gap-3">
                    <input type="text" id="commentInput" placeholder="Write a constructive comment..." 
                        class="flex-1 bg-slate-950 border border-slate-800 rounded-xl p-4 text-white focus:border-blue-500 outline-none text-sm transition-colors">
                    <button type="submit" class="btn-primary px-8 rounded-xl font-bold text-xs uppercase tracking-wider shadow-lg shadow-blue-900/20 hover:scale-105 transition-transform">Send</button>
                </form>
            </div>

        </section>
    </main>

    <script src="admin.js?v=4" defer></script>
    <script>
      (function ensureIcons(){ if (window.lucide && typeof window.lucide.createIcons === 'function') { window.lucide.createIcons(); } else { setTimeout(ensureIcons, 50); } })();
    </script>
    <!-- Space Background Script -->
    <script>
    function initSpaceBackground() {
        const canvas = document.getElementById('space-background');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        
        let width, height;
        let stars = [];
        let planets = [];
        const sun = { x: 0, y: 0, radius: 60, color: '#fbbf24', glow: '#f59e0b' };
        const moon = { x: 0, y: 0, radius: 30, color: '#e2e8f0', glow: '#94a3b8' };
        
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            initStars();
            initPlanets();
        }
        
        function initStars() {
            stars = [];
            for (let i = 0; i < 300; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    radius: Math.random() * 1.5,
                    alpha: Math.random(),
                    speed: Math.random() * 0.05
                });
            }
        }
        
        function initPlanets() {
            planets = [
                { r: 200, angle: 0, speed: 0.002, size: 12, color: '#3b82f6', name: 'Earth' },
                { r: 300, angle: 2, speed: 0.0015, size: 18, color: '#ef4444', name: 'Mars' },
                { r: 450, angle: 4, speed: 0.001, size: 35, color: '#d97706', name: 'Jupiter' },
                { r: 600, angle: 1, speed: 0.0008, size: 30, color: '#eab308', name: 'Saturn' }
            ];
            // Sun position (top left)
            sun.x = width * 0.1;
            sun.y = height * 0.2;
            // Moon relative to earth area but fixed for this animation style
            moon.x = width * 0.8;
            moon.y = height * 0.2;
        }
        
        function draw() {
            // Clear with a deep space gradient
            const grad = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width);
            grad.addColorStop(0, '#0f172a'); // Slate 900
            grad.addColorStop(1, '#020617'); // Slate 950
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, width, height);
            
            // Stars
            ctx.fillStyle = '#ffffff';
            stars.forEach(star => {
                ctx.globalAlpha = star.alpha;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fill();
                star.y -= star.speed;
                if (star.y < 0) star.y = height;
                // Twinkle
                star.alpha += (Math.random() - 0.5) * 0.05;
                if (star.alpha < 0.1) star.alpha = 0.1;
                if (star.alpha > 1) star.alpha = 1;
            });
            ctx.globalAlpha = 1;
            
            // Sun
            ctx.shadowBlur = 50;
            ctx.shadowColor = sun.glow;
            ctx.fillStyle = sun.color;
            ctx.beginPath();
            ctx.arc(sun.x, sun.y, sun.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Moon
            ctx.shadowBlur = 20;
            ctx.shadowColor = moon.glow;
            ctx.fillStyle = moon.color;
            ctx.beginPath();
            ctx.arc(moon.x, moon.y, moon.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Planets (orbiting center of screen)
            const cx = width / 2;
            const cy = height / 2;
            
            planets.forEach(p => {
                p.angle += p.speed;
                const px = cx + Math.cos(p.angle) * p.r;
                const py = cy + Math.sin(p.angle) * (p.r * 0.5); // Elliptical orbit
                
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(px, py, p.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Rings for Saturn
                if (p.name === 'Saturn') {
                    ctx.strokeStyle = 'rgba(234, 179, 8, 0.5)';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.ellipse(px, py, p.size * 1.8, p.size * 0.5, 0.2, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });
            
            requestAnimationFrame(draw);
        }
        
        window.addEventListener('resize', resize);
        resize();
        requestAnimationFrame(draw);
    }
    initSpaceBackground();
    </script>
</body>
</html>
